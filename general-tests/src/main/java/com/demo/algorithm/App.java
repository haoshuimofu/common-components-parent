package com.demo.algorithm;

import java.lang.reflect.Array;
import java.util.*;

import org.locationtech.spatial4j.io.GeohashUtils;

/**
 * 轨迹转geohash去重
 */
public class App {
    public static void main(String[] args) {
        String str1 = "103.888000,36.058165;103.887497,36.058262;103.887525,36.058371;103.887897,36.058281;103.888128,36.058230;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892813,36.058972;103.892820,36.058991";
        String str2 = "103.888000,36.058165;103.887497,36.058262;103.887525,36.058371;103.887897,36.058281;103.888128,36.058230;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892813,36.058972;103.892820,36.058991";
        String str3 = "103.888000,36.058165;103.888079,36.058162;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892813,36.058972;103.892820,36.058991";
        String str4 = "103.888000,36.058165;103.888079,36.058162;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892813,36.058972;103.892820,36.058991";
        String str5 = "103.888000,36.058165;103.888079,36.058162;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892813,36.058972;103.892820,36.058991";
        String str6 = "103.888000,36.058165;103.888079,36.058162;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892813,36.058972;103.892820,36.058991";
        String str7 = "103.888000,36.058165;103.888079,36.058162;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892813,36.058972;103.892820,36.058991";
        String str8 = "103.888000,36.058165;103.888079,36.058162;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892813,36.058972;103.892820,36.058991";
        String str9 = "103.888000,36.058165;103.888079,36.058162;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892820,36.058991";
        String str10 = "103.888000,36.058165;103.888079,36.058162;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892820,36.058991";
        String str11 = "103.888000,36.058165;103.888079,36.058162;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892820,36.058991";
        String str12 = "103.888000,36.058165;103.888079,36.058162;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892820,36.058991";
        String str13 = "103.888000,36.058165;103.888079,36.058162;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892820,36.058991";
        String str14 = "103.888000,36.058165;103.888079,36.058162;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892820,36.058991";
        String str15 = "103.888000,36.058165;103.887497,36.058262;103.888079,36.058162;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892813,36.058972;103.892820,36.058991";
        String str16 = "103.888000,36.058165;103.887497,36.058262;103.888079,36.058162;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892813,36.058972;103.892820,36.058991";
        String str17 = "103.888000,36.058165;103.887497,36.058262;103.888079,36.058162;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892813,36.058972;103.892820,36.058991";
        String str18 = "103.888000,36.058165;103.887497,36.058262;103.888079,36.058162;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892813,36.058972;103.892820,36.058991";
        String str19 = "103.888000,36.058165;103.887497,36.058262;103.888079,36.058162;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892820,36.058991";
        String str20 = "103.888000,36.058165;103.887497,36.058262;103.888079,36.058162;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892820,36.058991";
        String str21 = "103.888000,36.058165;103.887497,36.058262;103.888079,36.058162;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892820,36.058991";
        String str22 = "103.888000,36.058165;103.887497,36.058262;103.888079,36.058162;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892820,36.058991";
        String str23 = "103.888000,36.058165;103.887497,36.058262;103.887525,36.058371;103.887897,36.058281;103.888128,36.058230;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892820,36.058991";
        String str24 = "103.888000,36.058165;103.887497,36.058262;103.887525,36.058371;103.887897,36.058281;103.888128,36.058230;103.888487,36.058146;103.889776,36.057857;103.890943,36.057563;103.891012,36.057613;103.891612,36.059303;103.892838,36.059035;103.892820,36.058991";

        double dis1 = 706.93;
        double dis2 = 706.93;
        double dis3 = 601.62;
        double dis4 = 601.62;
        double dis5 = 601.62;
        double dis6 = 601.62;
        double dis7 = 601.62;
        double dis8 = 601.62;
        double dis9 = 597.01;
        double dis10 = 597.01;
        double dis11 = 597.01;
        double dis12 = 597.01;
        double dis13 = 597.01;
        double dis14 = 597.01;
        double dis15 = 694.96;
        double dis16 = 694.96;
        double dis17 = 694.96;
        double dis18 = 694.96;
        double dis19 = 690.35;
        double dis20 = 690.35;
        double dis21 = 690.35;
        double dis22 = 690.35;
        double dis23 = 702.32;
        double dis24 = 702.32;

        String edgeids1 = "5940300753779904693,5940300753779905569,5940300753779917317,5940300753779917316,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602,5940300753779897687";
        String edgeids2 = "5940300753779904693,5940300753779905569,5940300753779917317,5940300753779917316,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602,5940300753779897687";
        String edgeids3 = "5940300753779898286-1,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602,5940300753779897687";
        String edgeids4 = "5940300753779898286-1,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602,5940300753779897687";
        String edgeids5 = "5940300753779898286-1,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602,5940300753779897687";
        String edgeids6 = "5940300753779898286-1,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602,5940300753779897687";
        String edgeids7 = "5940300753779898286-1,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602,5940300753779897687";
        String edgeids8 = "5940300753779898286-1,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602,5940300753779897687";
        String edgeids9 = "5940300753779898286-1,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602";
        String edgeids10 = "5940300753779898286-1,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602";
        String edgeids11 = "5940300753779898286-1,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602";
        String edgeids12 = "5940300753779898286-1,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602";
        String edgeids13 = "5940300753779898286-1,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602";
        String edgeids14 = "5940300753779898286-1,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602";
        String edgeids15 = "5940300753779898286-0,5940300753779898286-1,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602,5940300753779897687";
        String edgeids16 = "5940300753779898286-0,5940300753779898286-1,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602,5940300753779897687";
        String edgeids17 = "5940300753779898286-0,5940300753779898286-1,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602,5940300753779897687";
        String edgeids18 = "5940300753779898286-0,5940300753779898286-1,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602,5940300753779897687";
        String edgeids19 = "5940300753779898286-0,5940300753779898286-1,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602";
        String edgeids20 = "5940300753779898286-0,5940300753779898286-1,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602";
        String edgeids21 = "5940300753779898286-0,5940300753779898286-1,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602";
        String edgeids22 = "5940300753779898286-0,5940300753779898286-1,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602";
        String edgeids23 = "5940300753779904693,5940300753779905569,5940300753779917317,5940300753779917316,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602";
        String edgeids24 = "5940300753779904693,5940300753779905569,5940300753779917317,5940300753779917316,5940300753779902166,5940300753779896666,5940300753779905594,5940300753779905590,5940300753779914602";

        String[] trastrLst = {str1, str2, str3, str4, str5, str6, str7, str8, str9, str10, str11, str12, str13, str14, str15, str16, str17, str18, str19, str20, str21, str22, str23, str24};
        Double[] disLst = {dis1, dis2, dis3, dis4, dis5, dis6, dis7, dis8, dis9, dis10, dis11, dis12, dis13, dis14, dis15, dis16, dis17, dis18, dis19, dis20, dis21, dis22, dis23, dis24};
//        String[] linkLst = {edgeids1,edgeids2,edgeids3,edgeids4,edgeids5,edgeids6,edgeids7,edgeids8,edgeids9,edgeids10,edgeids11,edgeids12,edgeids13,edgeids14,edgeids15,edgeids16,edgeids17,edgeids18,edgeids19,edgeids20,edgeids21,edgeids22,edgeids23,edgeids24};

        List<List<Point>> trasPoints = new ArrayList<>(trastrLst.length);
        for (String s : trastrLst) {
            trasPoints.add(parsePoints(s));
        }

        long time = System.currentTimeMillis();

//        Double[] trasPointsDis = new Double[trastrLst.length];
//        for (List<Point> trasPoint : trasPoints) {
//            double pDis = 0;
//            for (Point point : trasPoint) {
//                pDis+=point.getLng()+ point.getLat();
//            }
//        }

        Double[] processDis = new Double[disLst.length];
        HashMap<Double, Integer> disMap = new HashMap<Double, Integer>();
        for (int i = 0; i < trastrLst.length; i++) {
            double pDis = 0;
            for (int j = 0; j < trasPoints.get(i).size(); j++) {
                pDis += trasPoints.get(i).get(j).getLng();
                pDis += trasPoints.get(i).get(j).getLat();
            }
            processDis[i] = disLst[i] / 10 + pDis / 10;
            if (!disMap.containsKey(processDis[i])) {
                disMap.put(processDis[i], i);
            }
        }

//        HashSet<String> diset = new HashSet<>(Arrays.asList(processDis));

//        HashMap<String,ArrayList<String>> disMap = new HashMap<String,ArrayList<String>>();


//        for (String aString : diset) {
//            disMap.put(aString,new ArrayList<String>(24));
//        }
//        ArrayList<String> re = new ArrayList<String>(diset.size());
//        for (int i = 0; i < trastrLst.length; i++) {
//            String s = disLst[i] / 10 + trastrLst[i].substring(trastrLst[i].length() / 5, trastrLst[i].length() * 4 / 5);
//            if (!disMap.containsKey(s))
//            {
//                disMap.put(s,i);
//            };
//        }

        for (Integer s : disMap.values()) {
            System.out.println(trastrLst[s]);
        }

        System.out.println("耗时：" + (System.currentTimeMillis() - time) + "毫秒");
    }

    static String encode(String tra) {
        String[] tralist = tra.split(";"); // 分割字符串
        StringBuilder hashBuffer = new StringBuilder();
        String last = null;
        for (int i = 0; i < tralist.length; i++) {
            String[] lonLat = tralist[i].split(",");
            int precision = 8;
            String hash = GeohashUtils.encodeLatLon(Double.parseDouble(lonLat[1]), Double.parseDouble(lonLat[0]), precision);
            if (i == 0 || !last.equals(hash)) {
                hashBuffer.append(hash);
                last = hash;
            }
        }
        return hashBuffer.toString();
    }

    private static List<Point> parsePoints(String line) {
        String[] pts = line.split(";");
        List<Point> points = new ArrayList<>(pts.length);
        for (int i = 0; i < pts.length; i++) {
            String[] lngLat = pts[i].split(",");
            points.add(new Point(Double.parseDouble(lngLat[0]), Double.parseDouble(lngLat[1])));
        }
        return points;
    }

    static class Point {

        private double lng;
        private double lat;

        public Point(double lng, double lat) {
            this.lng = lng;
            this.lat = lat;
        }

        public double getLng() {
            return lng;
        }

        public double getLat() {
            return lat;
        }
    }

}

